<!DOCTYPE html><html><head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="description">
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/animancer/v4-0/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/animancer/v4-0/assets/img/favicon.ico" type="image/x-icon">
        <title>Animancer - 02 Doors</title>
        <link href="/animancer/v4-0/assets/css/highlight.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/adminlte/AdminLTE.css" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/theme/theme.css" rel="stylesheet">
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/animancer/v4-0/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/animancer/v4-0/assets/css/override.css" rel="stylesheet">
        <script src="/animancer/v4-0/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/animancer/v4-0/assets/js/bootstrap.min.js"></script>        
        <script src="/animancer/v4-0/assets/js/app.min.js"></script>         
        <script src="/animancer/v4-0/assets/js/highlight.pack.js"></script>   
        <script src="/animancer/v4-0/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/animancer/v4-0/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/animancer/v4-0/assets/js/mermaid.min.js"></script>
        <script src="/animancer/v4-0/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/animancer/v4-0/assets/js/html5shiv.min.js"></script>
        <script src="/animancer/v4-0/assets/js/respond.min.js"></script>
        <![endif]-->  

        
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/animancer/v4-0/" class="logo">
                            <span>Animancer</span>
                </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/animancer/v4-0/docs"><img src="/animancer/v4-0/images/docs.png" height="20" style="position:relative; left:-5px; top:-1px;"> Docs</a></li>
        <li><a href="/animancer/v4-0/docs/help"><img src="/animancer/v4-0/images/help.png" height="20" style="position:relative; left:-4px; top:-1px;"> Help</a></li>
        <li><a href="/animancer/v4-0/api/Animancer/AnimancerComponent"><img src="/animancer/v4-0/images/api.png" height="20" style="position:relative; left:-3px; top:-1px;"> API v4.0</a></li>
        <li><a href="/animancer/lite"><img src="/animancer/v4-0/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Try</a></li>
        <li><a href="/animancer/pro"><img src="/animancer/v4-0/images/unity-logo.png" height="20" style="position:relative; left:-4px; top:-1px;"> Buy</a></li>
        <li><a href="https://kybernetik.com.au/kailas-dierk/unity-assets"><img src="/animancer/v4-0/images/kybernetik.png" height="20" style="position:relative; left:-2px; top:-1px;"> Other Assets</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
<a href="/animancer" style="font-size:1.42em; color:white">This is the <strong>Animancer v4.0 Beta</strong> Documentation. Click Here to return to the v3.1 Documentation.</a>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
    <div id="infobar-headings"><h6>On This Page</h6><p><a href="#interaction-system">Interaction System</a></p>
<p><a href="#basic-door">Basic Door</a></p>
<p><a href="#openness">Openness</a></p>
<p><a href="#edit-mode">Edit Mode</a></p>
<hr class="infobar-hidden">
</div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

                <li><a href="/animancer/v4-0/docs/help">Help and FAQ</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/introduction">Introduction</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/introduction/features">Features</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer">Mecanim vs. Animancer</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/why-replace-mecanim">Why Replace Mecanim?</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/playing">Playing</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/waiting">Waiting</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/speed-and-time">Speed and Time</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/weapon-animations">Weapon Animations</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/mecanim-vs-animancer/performance">Performance</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/introduction/glossary">Glossary</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/introduction/cs">C# in Unity</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/introduction/cs/overview">Scripting Overview</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/organisation">Organisation</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/variables">Variables</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/methods">Methods</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/inheritance">Inheritance</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/vectors">Vectors</a></li>
                <li><a href="/animancer/v4-0/docs/introduction/cs/other">Other Topics</a></li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/v4-0/docs/examples">Examples</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/basics">01 Basics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/basics/scene-setup">Basic Scene Setup</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/quick-play">01 Quick Play</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/playing-and-fading">02 Playing and Fading</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/sequence-coroutine">03 Sequence Coroutine</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/named-animations">04 Named Animations</a></li>
                <li><a href="/animancer/v4-0/docs/examples/basics/hybrid">05 Hybrid Basics</a></li>

                    </ul>
                </li>
                <li class="treeview active">
                    <a href="/animancer/v4-0/docs/examples/fine-control">02 Fine Control</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/fine-control/spider-bot">01 Spider Bot</a></li>
                <li class="selected"><a href="/animancer/v4-0/docs/examples/fine-control/doors">02 Doors</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fine-control/solo-animation">03 Solo Animation</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/locomotion">03 Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/locomotion/walk-and-run">01 Walk and Run</a></li>
                <li><a href="/animancer/v4-0/docs/examples/locomotion/root-motion">02 Root Motion</a></li>
                <li><a href="/animancer/v4-0/docs/examples/locomotion/linear-blending">03 Linear Blending</a></li>
                <li><a href="/animancer/v4-0/docs/examples/locomotion/directional-blending">04 Directional Blending</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/directional-sprites">04 Directional Sprites</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/directional-sprites/basic-movement">01 Basic Movement</a></li>
                <li><a href="/animancer/v4-0/docs/examples/directional-sprites/character-controller">02 Character Controller</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/events">05 Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/events/footsteps">01 Footstep Events</a></li>
                <li><a href="/animancer/v4-0/docs/examples/events/golf">02 Golf Events</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/fsm">06 State Machines</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/fsm/creatures">01 Creatures</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fsm/interrupt-management">02 Interrupt Management</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fsm/brains">03 Brains</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fsm/more-brains">04 More Brains</a></li>
                <li><a href="/animancer/v4-0/docs/examples/fsm/platformer">05 Platformer</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/examples/layers">07 Layers</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/ik">08 Inverse Kinematics</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/ik/puppet">01 Puppet</a></li>
                <li><a href="/animancer/v4-0/docs/examples/ik/uneven-ground">02 Uneven Ground</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers">09 Animator Controllers</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/hybrid">01 Hybrid Mini Game</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit">02 3D Game Kit</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/problems">Problems with the Original</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/respawn">Respawn</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/idle">Idle</a></li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion">Locomotion</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion/movement">Movement</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/locomotion/turning">Turning</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/airborne">Airborne</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/landing">Landing</a></li>
                <li><a href="/animancer/v4-0/docs/examples/animator-controllers/3d-game-kit/attack">Attack</a></li>

                    </ul>
                </li>

                    </ul>
                </li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual">User Manual</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/playing">Playing Animations</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/playing/states">States</a></li>
                <li><a href="/animancer/v4-0/docs/manual/playing/inspector">Inspector</a></li>
                <li><a href="/animancer/v4-0/docs/manual/playing/component-types">Component Types</a></li>
                <li><a href="/animancer/v4-0/docs/manual/playing/directional-sets">Directional Animation Sets</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/transitions">Transitions</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/transitions/types">Transition Types</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/blending">Blending</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/blending/fading">Fading</a></li>
                <li><a href="/animancer/v4-0/docs/manual/blending/layers">Layers</a></li>
                <li><a href="/animancer/v4-0/docs/manual/blending/mixers">Mixers</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/manual/events">Events</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/manual/events/animation">Animation Events</a></li>
                <li><a href="/animancer/v4-0/docs/manual/events/animancer">Animancer Events</a></li>
                <li><a href="/animancer/v4-0/docs/manual/events/end">End Events</a></li>

                    </ul>
                </li>
                <li><a href="/animancer/v4-0/docs/manual/fsm">Finite State Machines</a></li>
                <li><a href="/animancer/v4-0/docs/manual/animator-controllers">Animator Controllers</a></li>
                <li><a href="/animancer/v4-0/docs/manual/ik">Inverse Kinematics</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/bugs">Unity Bugs</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/bugs/inconsistent-timing">Inconsistent Timing</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/paused-skinned-mesh-update">Paused Skinned Mesh Update</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/resetting-animated-values">Resetting Animated Values</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/unused-graph-destroy-warning">Unused Graph Destroy Warning</a></li>
                <li><a href="/animancer/v4-0/docs/bugs/update-modes">Update Modes</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/source">Source Code</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/source/dlls">DLLs</a></li>
                <li><a href="/animancer/v4-0/docs/source/creating-custom-states">Creating Custom States</a></li>
                <li><a href="/animancer/v4-0/docs/source/graph-structure">Graph Structure</a></li>
                <li><a href="/animancer/v4-0/docs/source/asset-sources">Asset Sources</a></li>
                <li><a href="/animancer/v4-0/docs/source/coding-standard">Coding Standard</a></li>
                <li><a href="/animancer/v4-0/docs/source/default-script-template">Default Script Template</a></li>

                    </ul>
                </li>
                <li class="treeview">
                    <a href="/animancer/v4-0/docs/changes">Change Log</a> <a href="#" class="expand"></a>
                    <ul class="treeview-menu">
                        
                <li><a href="/animancer/v4-0/docs/changes/animancer-v4-0-beta">Beta Test v4.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v4-0">Progress of v4.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v3-1">Animancer v3.1</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v3-0">Animancer v3.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v2-0">Animancer v2.0</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-3">Animancer v1.3</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-2">Animancer v1.2</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-1">Animancer v1.1</a></li>
                <li><a href="/animancer/v4-0/docs/changes/animancer-v1-0">Animancer v1.0</a></li>

                    </ul>
                </li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>02 Doors</h1>
		</section>
	<section class="content">
		<blockquote class="blockquote">
<p><strong>Difficulty</strong>: <a href="../../../introduction/glossary#example-difficulty">Intermediate</a></p>
<p><strong>Location</strong>: <em>Assets/Plugins/Animancer/Examples/02 Fine Control/02 Doors</em></p>
<p><strong>Namespace</strong>: <a href="../../../../api/Animancer.Examples.FineControl"><code>Animancer.Examples.FineControl</code></a></p>
</blockquote>
<p>This example demonstrates how you can use a single animation and some simple scripting to create a system for doors that can be opened and closed, can start open, closed, or anywhere inbetween, and can show the starting state in Edit Mode.</p>
<p><em><a href="../../../introduction/features"><strong>Pro-Only Features</strong></a> are used in this example: modifying <code>AnimancerState.Speed</code> and <code><a href="/animancer/v4-0/api/Animancer/AnimancerState/617EFC91">AnimancerState.NormalizedTime</a></code>. Animancer Lite allows you to try out these features in the Unity Editor, but they are not available in runtime builds unless you purchase <a href="/animancer/pro">Animancer Pro</a>.</em></p>
<p>The video below shows several doors:</p>
<ul>
<li>They start in different states: from left to right they are closed, 60% open, and fully open.</li>
<li>Clicking on a door toggles its state.</li>
<li>Since the middle door starts closer to fully open than closed, the first interaction closes it.</li>
<li>On the last door we also see that it can be interrupted at any time to change direction.</li>
</ul>
<p><img src="doors.gif" class="img-responsive"></p>
<p>There are only 2 scripts in this example:</p>
<p></p><details><summary>The <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/ClickToInteract">ClickToInteract</a></code> script defines an <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a></code> interface and forms the basis for a simple interaction system:</summary><p>
</p><pre><code class="language-cs">using Animancer;
using UnityEngine;

public interface <a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a>
{
    void Interact();
}

public sealed class <a href="/animancer/v4-0/api/Animancer.Examples.FineControl/ClickToInteract">ClickToInteract</a> : MonoBehaviour
{
    private void Update()
    {
        if (!Input.GetMouseButtonDown(0))
            return;

        var ray = Camera.main.ScreenPointToRay(Input.mousePosition);

        RaycastHit raycastHit;
        if (Physics.Raycast(ray, out raycastHit))
        {
            var interactable = raycastHit.collider.GetComponentInParent&lt;<a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a>&gt;();
            if (interactable != null)
                interactable.Interact();
        }
    }
}
</code></pre>
<p>You can simply add a <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/ClickToInteract">ClickToInteract</a></code> component to any object in the scene so that whenever you click the mouse it will look for any component that implements the <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a></code> <a href="../../../introduction/cs/inheritance#interfaces">Interface</a> on the clicked object or any of its parents or children (in that order) and call <code>Interact</code> on the first one it finds.</p>
<p></p></details><p></p>
<p></p><details><summary>The <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/Door">Door</a></code> script implements <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a></code> to demonstrate the main purpose of this example:</summary><p>
</p><pre><code class="language-cs">using Animancer;
using UnityEngine;

[SelectionBase]
public sealed class <a href="/animancer/v4-0/api/Animancer.Examples.FineControl/Door">Door</a> : MonoBehaviour, <a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a>
{
    [SerializeField] private <a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a> _Animancer;
    [SerializeField] private AnimationClip _Open;

    [SerializeField, Range(0, 1)]
    private float _Openness;

    private void Awake()
    {
        var state = _Animancer.Play(_Open);
        state.NormalizedTime = _Openness;

        _Animancer.Evaluate();
        _Animancer.Playable.PauseGraph();

        state.Events.OnEnd = _Animancer.Playable.PauseGraph;
    }

    public void Interact()
    {
        var state = _Animancer.States[_Open];

        if (_Openness &gt; 0.5f)
        {
            state.Speed = -1;
            _Openness = 0;
        }
        else
        {
            state.Speed = 1;
            _Openness = 1;
        }

        _Animancer.Playable.UnpauseGraph();
    }

#if UNITY_EDITOR
    private void OnValidate()
    {
        UnityEditor.EditorApplication.delayCall += () =&gt;
        {
            if (_Animancer == null || _Open == null || this == null)
                return;

            Awake();
        };
    }
#endif
}
</code></pre>
<p></p></details><p></p>
<h1 id="interaction-system">Interaction System</h1>
<p>We could have just hard coded the interaction system in the <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/Door">Door</a></code> script or controlled it using UI <code>Button</code>s, but in the interest of encouraging good practices rather than simply getting the job done quickly this example uses a more modular approach.</p>
<p>The <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/ClickToInteract">ClickToInteract</a></code> component is a somewhat hacky substitute for whatever mechanism you might use to trigger interactions in a real game. It has a fairly simple <code>Update</code> method which waits for the user to Left Click then uses a raycast to determine what they clicked on and tries to find a component that implements the <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a></code> <a href="../../../introduction/cs/inheritance#interfaces">Interface</a> attached to that object or any of its parents. If it finds something, it calls the <code>Interact</code> method on that component, whatever it may be.</p>
<p>This allows the interaction system to be decoupled from the actual interactable objects. It has no idea what kinds of things can be interacted with or what they will do, it just tells them when it's interacting with them. We could add more different types of interactable objects without touching the interaction system or we could change the interaction system without touching the interactable objects. For example, First Person Shooter games wouldn't want Left Click to trigger interactions, they commonly use <code>E</code> instead (since it's near <code>WASD</code> on a QWERTY keyboard) and instead of using an infinite length raycast they commonly limit interactions to a short distance in front of the player. But <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/Door">Door</a></code>s do not need to know about either of those changes, they just open and close when something tells them to.</p>
<p></p><details><summary>We could test this system by writing a very simple script that implements the <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a></code> interface to log a message and putting it on a cube in the scene (or any object with a <code>Collider</code>):</summary><p>
</p><pre><code class="language-cs">using UnityEngine;

namespace Animancer.Examples.FineControl
{
    public sealed class ClickMe : MonoBehaviour, <a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a>
    {
        public void Interact()
        {
            Debug.Log("You interacted with " + name);
        }
    }
}
</code></pre>
<p>The <a href="../../../introduction/cs/organisation#namespaces">Namespace</a> is necessary because the <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a></code> <a href="../../../introduction/cs/inheritance#interfaces">Interface</a> is located in that namespace. Alternatively, you could put <code>using Animancer.Examples.FineControl;</code> at the top of the script, or specify the full name of <code>Animancer.Examples.FineControl.IInteractable</code> when refering to it.</p>
<p></p></details><p></p>
<p>A more complex interaction system might give the <code>Interact</code> method a parameter for details about the triggering object. For example, in addition to the animation it uses on itself, a <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/Door">Door</a></code> could have a <em>Humanoid-OpenDoor</em> animation which it plays on the character who interacts with it. A <code>Lever</code> might do something similar to allow people to pull it. And so on, all without the character needing to hold interaction animations for every possible object. Or the responsibility could be reversed: still give the <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/Door">Door</a></code> or <code>Lever</code> its corresponding humanoid animation, but simply expose it as an <code>InteractionAnimation</code> property in the <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a></code> <a href="../../../introduction/cs/inheritance#interfaces">Interface</a> so that when a character triggers the interaction they can also check if there's an animation they need to play.</p>
<h1 id="basic-door">Basic Door</h1>
<p>The <em>OpenDoor</em> animation rotates the door from closed to open and we do not have a second animation to close it again. So to create a system that can both open and close we just need to manipulate the animation's <code>Speed</code> to play forwards or backwards.</p>
<p>First we need a new script to implement the <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a></code> interface and reference the <code><a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a></code> and the <code>AnimationClip</code>:</p>
<pre><code class="language-cs">using Animancer;
using UnityEngine;

namespace Animancer.Examples.FineControl
{
    public sealed class DoorTutorial : MonoBehaviour, <a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a>
    {
        [SerializeField] private <a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a> _Animancer;
        [SerializeField] private AnimationClip _Open;
    }
}
</code></pre>
<p>As with the simple <code>ClickMe</code> example above, the <a href="../../../introduction/cs/organisation#namespaces">Namespace</a> is necessary because the <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a></code> <a href="../../../introduction/cs/inheritance#interfaces">Interface</a> is located in that namespace. Alternatively, you could put <code>using Animancer.Examples.FineControl;</code> at the top of the script, or specify the full name of <code>Animancer.Examples.FineControl.IInteractable</code> when refering to it.</p>
<p>That will give us a compiler error because the <code><a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a></code> <a href="../../../introduction/cs/inheritance#interfaces">Interface</a> requires the implementer to have an <code>Interact</code> method. So let us add a <a href="../../../introduction/cs/variables#fields">Field</a> to keep track of whether it is open or not and implement the <code>Interact</code> method to toggle the state and play the animation with the appropriate speed:</p>
<pre><code class="language-cs">private bool _IsOpen;

public void Interact()
{
    // Toggle the state.
    _IsOpen = !_IsOpen;

    // Make sure the animation is playing.
    var state = _Animancer.Play(_Open);

    // If the door is opening, play forwards.
    if (_IsOpen)
        state.Speed = 1;
    else// Otherwise play backwards.
        state.Speed = -1;
}
</code></pre>
<p>One last thing that method needs to do is pause the graph when the animation finishes. Otherwise the animation <code>Time</code> would continue increasing after it ends and when we reverse the <code>Speed</code> we would have to wait for the <code>Time</code> to go all the way back down to the end of the animation before anything happens. And since we pause the graph we are responsible for unpausing it as well. That can be done very easily using an <a href="../../../manual/events/end">End Event</a>.</p>
<pre><code class="language-cs">public void Interact()
{
    ...

    // Unpause now.
    _Animancer.Playable.UnpauseGraph();

    // Pause when done.
    state.Events.OnEnd = _Animancer.Playable.PauseGraph;
}
</code></pre>
<p></p><details><summary>The full script now looks like this:</summary><p>
</p><pre><code class="language-cs">using Animancer;
using UnityEngine;

public sealed class DoorTutorial : MonoBehaviour, <a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a>
{
    [SerializeField] private <a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a> _Animancer;
    [SerializeField] private AnimationClip _Open;

    private bool _IsOpen;

    public void Interact()
    {
        _IsOpen = !_IsOpen;

        var state = _Animancer.Play(_Open);

        if (_IsOpen)
            state.Speed = 1;
        else
            state.Speed = -1;

        _Animancer.Playable.UnpauseGraph();

        state.Events.OnEnd = _Animancer.Playable.PauseGraph;
    }
}
</code></pre>
<p></p></details><p></p>
<p>That gives us a door which starts closed and can be clicked on to toggle between open and closed.</p>
<p><img src="basic-door.gif" class="img-responsive"></p>
<h1 id="openness">Openness</h1>
<p>What we've got so far is quite functional and would get the job done if we were happy with all doors starting closed when the scene loads, but we can still improve upon that. We could make the <code>_IsOpen</code> field serialized to be able to start some doors open, but we can do even better than that. Instead, let's make it so that doors can start anywhere between as well.</p>
<p>First we want a <code>float</code> with a value between 0 and 1. Instead of a regular <code>float</code> field where you can type in any value, the <code>Range</code> attribute tells Unity to draw it using a slider that can only go between the specified values.</p>
<table class="table">
  <thead>
    <tr><th style="width:50%">Code</th>
    <th style="width:50%">Inspector</th>
  </tr></thead>
  <tbody>
    <tr>
      <td>
<pre><code class="language-cs">[SerializeField, Range(0, 1)]
private float _Openness;
</code></pre>
<p>Note that the <code>[Range]</code> attribute only affects the Inspector. It will not prevent your code from setting the value to anything you want.</p>
</td>
      <td><img src="inspector.png" class="img-responsive"></td>
    </tr>
  </tbody>
</table>
<p>Then we need to apply that value on startup:</p>
<pre><code class="language-cs">private void Awake()
{
    // Play the animation immediately.
    var state = _Animancer.Play(_Open);

    // Set our new field as the NormalizedTime.
    // This is why the 0 to 1 range is important.
    state.NormalizedTime = _Openness;

    // We do not actually want the animation to play though,
    // we just want to apply its value at the time we just set.
    _Animancer.Evaluate();
    _Animancer.Playable.PauseGraph();

    // We still need to pause it whenever it finishes.
    state.Events.OnEnd = _Animancer.Playable.PauseGraph;
}
</code></pre>
<p>All the <code><a href="/animancer/v4-0/api/Animancer/AnimancerState/11AD60E8">AnimancerState.Events</a></code> would normally be cleared whenever we play a new animation, but since there is only one animation we just leave it playing and pause/unpause the graph instead.</p>
<p>Finally, we need to make a few adjustments to the <code>Interact</code> method:</p>
<pre><code class="language-cs">public void Interact()
{
    // Get the state we created in Awake.
    // Or we could have stored it in a field when we made it.
    var state = _Animancer.States[_Open];

    // If nearly closed, play the animation forwards.
    if (_Openness &lt; 0.5f)
    {
        state.Speed = 1;
        _Openness = 1;
    }
    else// Otherwise play it backwards.
    {
        state.Speed = -1;
        _Openness = 0;
    }

    // And make sure the graph is playing as mentioned above.
    // The state is already playing since we never stopped it.
    _Animancer.Playable.UnpauseGraph();
}
</code></pre>
<p>Note how we immediately set the <code>_Openness</code> to 0 or 1. We are using it as the destination value rather than an indication of how open the door currently is (we could use <code>state.NormalizedTime</code> if we wanted that). This means that interrupting the animation will always toggle it to go the other way like our original script rather than choosing which way to go based on how open the door currently is (except for the first interaction after startup).</p>
<p></p><details><summary>The full script now looks like this:</summary><p>
</p><pre><code class="language-cs">using Animancer;
using UnityEngine;

public sealed class DoorTutorial : MonoBehaviour, <a href="/animancer/v4-0/api/Animancer.Examples.FineControl/IInteractable">IInteractable</a>
{
    [SerializeField] private <a href="/animancer/v4-0/api/Animancer/AnimancerComponent">AnimancerComponent</a> _Animancer;
    [SerializeField] private AnimationClip _Open;

    [SerializeField, Range(0, 1)]
    private float _Openness;

    private void Awake()
    {
        var state = _Animancer.Play(_Open);
        state.NormalizedTime = _Openness;
        _Animancer.Evaluate();
        _Animancer.Playable.PauseGraph();

        state.Events.OnEnd = _Animancer.Playable.PauseGraph;
    }

    public void Interact()
    {
        var state = _Animancer.States[_Open];

        if (_Openness &lt; 0.5f)
        {
            state.Speed = 1;
            _Openness = 1;
        }
        else
        {
            state.Speed = -1;
            _Openness = 0;
        }

        _Animancer.Playable.UnpauseGraph();
    }
}
</code></pre>
<p></p></details><p></p>
<p>Now we can use the slider to choose how open the door is when the scene loads.</p>
<p><img src="openness.gif" class="img-responsive"></p>
<h1 id="edit-mode">Edit Mode</h1>
<p>That works great at runtime, but it would be annoying to have to go into Play Mode every time we want to see exactly how open a door will be. Fortunately, Animancer allows you to play animations in <a href="../../../manual/playing#edit-mode">Edit Mode</a> without much trouble.</p>
<p>The <code>OnValidate</code> method is called by Unity in Edit Mode whenever an instance of this script is loaded or a value is changed in the Inspector, so we can use it to apply the initial state we want on the door.</p>
<p>Unfortunately, <code>OnValidate</code> is called right after Unity reloads scripts but before it is actually ready to play an animation properly so it gives an error if we try to do so. We can avoid that by using <code>EditorApplication.delayCall</code> to delay the call for a frame. We could check those in <code>Awake</code>, but we actually want it to give an exception if that happens at runtime because that would mean the door will not work.</p>
<pre><code class="language-cs">#if UNITY_EDITOR
private void OnValidate()
{
    UnityEditor.EditorApplication.delayCall += () =&gt;
    {
        if (_Animancer == null || _Open == null)
            return;

        Awake();
    };
}
#endif
</code></pre>
<p>Now we have a door that can start anywhere between open and closed and will show that state in Edit Mode as well.</p>
<p><img src="edit-mode.gif" class="img-responsive"></p>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                Generated by <a href="https://wyam.io">Wyam</a>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    
</body></html>